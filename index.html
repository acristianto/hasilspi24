
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard SPI 2024</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
var rawData = [], radarChart, barChart, lineChartHistorical, lineChartFaktorKoreksi;

fetch("https://raw.githubusercontent.com/timotiushps/hasilspi24/main/agregat_tracking_agregat.csv")
  .then(response => response.text())
  .then(csvText => {
    Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        rawData = results.data.filter(r => r["data.instansi"] && r["Index_name"] && r["Value24"]);
        populateInstansiOptions();
        document.getElementById("loadingSpinner").classList.add("d-none");
      }
    });
  })
  .catch(error => {
    console.error("Gagal memuat data:", error);
    document.getElementById("loadingSpinner").innerHTML = "<p class='text-danger'>Gagal memuat data dari GitHub.</p>";
  });
</script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js">
function renderRadarChart(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  const avg = data.reduce((a, b) => a + b, 0) / data.length;
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);

  if (avg >= 78) {
    gradient.addColorStop(0, "rgba(0,200,0,0.4)");
    gradient.addColorStop(1, "rgba(0,150,0,0.2)");
  } else if (avg >= 73) {
    gradient.addColorStop(0, "rgba(255,200,0,0.4)");
    gradient.addColorStop(1, "rgba(200,150,0,0.2)");
  } else {
    gradient.addColorStop(0, "rgba(200,0,0,0.4)");
    gradient.addColorStop(1, "rgba(150,0,0,0.2)");
  }

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  });
}

</script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2">
function renderRadarChart(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  const avg = data.reduce((a, b) => a + b, 0) / data.length;
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);

  if (avg >= 78) {
    gradient.addColorStop(0, "rgba(0,200,0,0.4)");
    gradient.addColorStop(1, "rgba(0,150,0,0.2)");
  } else if (avg >= 73) {
    gradient.addColorStop(0, "rgba(255,200,0,0.4)");
    gradient.addColorStop(1, "rgba(200,150,0,0.2)");
  } else {
    gradient.addColorStop(0, "rgba(200,0,0,0.4)");
    gradient.addColorStop(1, "rgba(150,0,0,0.2)");
  }

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  });
}

</script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js">
function renderRadarChart(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  const avg = data.reduce((a, b) => a + b, 0) / data.length;
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);

  if (avg >= 78) {
    gradient.addColorStop(0, "rgba(0,200,0,0.4)");
    gradient.addColorStop(1, "rgba(0,150,0,0.2)");
  } else if (avg >= 73) {
    gradient.addColorStop(0, "rgba(255,200,0,0.4)");
    gradient.addColorStop(1, "rgba(200,150,0,0.2)");
  } else {
    gradient.addColorStop(0, "rgba(200,0,0,0.4)");
    gradient.addColorStop(1, "rgba(150,0,0,0.2)");
  }

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  });
}

</script>
</head>
<body style="background-color:white">
<div class="container py-4">
  <header class="mb-4 d-flex justify-content-between align-items-center">
    <img src="https://elhkpn.kpk.go.id/portal-assets/img/image2.jpeg" style="height:50px;" />
    <h1 class="text-center flex-grow-1">Dashboard Indeks Hasil SPI 2024</h1>
    <img src="https://spi.kpk.go.id/img/logo-spi.d5368d4c.png" style="height:50px;" />
  </header>

  <div id="loadingSpinner" class="text-center my-4 d-none">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 text-muted">Memuat data...</p>
  </div>

  

  <div class="mb-3">
    <label for="instansiInput" class="form-label">Ketik Nama Instansi:</label>
    <input class="form-control" list="instansiList" id="instansiInput" placeholder="Cari...">
    <datalist id="instansiList"></datalist>
  </div>

  <div class="card p-4 mb-4 shadow-sm text-center">
    <h4 id="summaryTitle" class="mb-4 fw-semibold text-center"></h4>
    <div class="d-flex justify-content-center align-items-end flex-wrap gap-3">
      <div class="text-center">
        <div id="agregatVal" class="fs-1 fw-bold">-</div>
        <div class="small text-muted">(Agregat)</div>
      </div>
      <div class="fs-4">=</div>
      <div class="text-center">
        <div id="internalVal" class="fs-3 fw-bold">-</div>
        <div class="small text-muted">(Internal)</div>
      </div>
      <div class="fs-4">+</div>
      <div class="text-center">
        <div id="eksternalVal" class="fs-3 fw-bold">-</div>
        <div class="small text-muted">(Eksternal)</div>
      </div>
      <div class="fs-4">+</div>
      <div class="text-center">
        <div id="eksperVal" class="fs-3 fw-bold">-</div>
        <div class="small text-muted">(Eksper)</div>
      </div>
      <div class="fs-4">-</div>
      <div class="text-center">
        <div id="faktorVal" class="fs-3 fw-bold">-</div>
        <div class="small text-muted">(Faktor Koreksi)</div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 mb-4">
      <h5 class="text-center">Indeks Agregat (Sebelum Faktor Koreksi)</h5>
      <canvas id="radarChart"></canvas>
    </div>
    <div class="col-md-6 mb-4">
      <h5 class="text-center mb-2">Faktor Koreksi</h5>
      <canvas id="barChart"></canvas>
    </div>
    <div class="col-12 mb-4">
      <h5 class="text-center mb-2">Tren Indeks Agregat, Internal, Eksternal, Eksper (2021â€“2024)</h5>
      <canvas id="lineChartHistorical"></canvas>
    </div>
    <div class="col-12 mb-4">
      <h5 class="text-center mb-2">Tracking Faktor Koreksi (Prevalensi Korupsi & Integritas SPI)</h5>
      <canvas id="lineChartFaktorKoreksi"></canvas>
    </div>
  </div>
</div>

<script>


document.getElementById("csvFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (file) {
    document.getElementById("loadingSpinner").classList.remove("d-none");
    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        rawData = results.data.filter(r => r["data.instansi"] && r["Index_name"] && r["Value24"]);
        populateInstansiOptions();
        document.getElementById("loadingSpinner").classList.add("d-none");
      }
    });
  }
});

function populateInstansiOptions() {
  const list = document.getElementById("instansiList");
  list.innerHTML = "";
  const input = document.getElementById("instansiInput");
  const instansiList = [...new Set(rawData.map(r => r["data.instansi"]))];
  instansiList.forEach(name => {
    const option = document.createElement("option");
    option.value = name;
    list.appendChild(option);
  });
  input.value = "Seluruh K/L/PD Peserta SPI 2024";
  input.addEventListener("change", updateDashboard);
  updateDashboard();
}

function updateDashboard() {
  const selected = document.getElementById("instansiInput").value;
  const filtered = rawData.filter(r => r["data.instansi"] === selected);
  if (filtered.length === 0) return;

  const get = name => {
    const found = filtered.find(d => d["Index_name"] === name);
    return found ? parseFloat(found["Value24"]) : null;
  };

  const vals = {
    agregat: get("Agregat"),
    internal: get("Internal"),
    eksternal: get("Eksternal"),
    eksper: get("Eksper"),
    faktor: get("Faktor Koreksi (weighted)"),
    prevalensi: get("Prevalensi Korupsi"),
    integritas: get("Integritas Pelaksanaan SPI")
  };

  document.getElementById("summaryTitle").textContent = "Indeks Integritas " + selected;
  const colorMap = val => val > 78 ? "green" : val >= 73 ? "orange" : "red";
  ["agregat", "internal", "eksternal", "eksper", "faktor"].forEach(k => {
    const el = document.getElementById(k + "Val");
    el.textContent = vals[k]?.toFixed(2) || "-";
    if (vals[k] !== null) el.style.color = colorMap(vals[k]);
  });

  renderRadarChart([vals.internal, vals.eksternal, vals.eksper]);
  renderStackedBar(vals.prevalensi, vals.integritas);
  renderHistoricalLineChart(filtered);
  renderFaktorKoreksiLineChart(filtered);
}







renderRadarChart = function(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: { r: { suggestedMin: 0, suggestedMax: 100 } }
    }
  });
}

function renderRadarChart(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  const avg = data.reduce((a, b) => a + b, 0) / data.length;
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);

  if (avg >= 78) {
    gradient.addColorStop(0, "rgba(0,200,0,0.4)");
    gradient.addColorStop(1, "rgba(0,150,0,0.2)");
  } else if (avg >= 73) {
    gradient.addColorStop(0, "rgba(255,200,0,0.4)");
    gradient.addColorStop(1, "rgba(200,150,0,0.2)");
  } else {
    gradient.addColorStop(0, "rgba(200,0,0,0.4)");
    gradient.addColorStop(1, "rgba(150,0,0,0.2)");
  }

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  });
}

</script>

<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2">
function renderRadarChart(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  const avg = data.reduce((a, b) => a + b, 0) / data.length;
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);

  if (avg >= 78) {
    gradient.addColorStop(0, "rgba(0,200,0,0.4)");
    gradient.addColorStop(1, "rgba(0,150,0,0.2)");
  } else if (avg >= 73) {
    gradient.addColorStop(0, "rgba(255,200,0,0.4)");
    gradient.addColorStop(1, "rgba(200,150,0,0.2)");
  } else {
    gradient.addColorStop(0, "rgba(200,0,0,0.4)");
    gradient.addColorStop(1, "rgba(150,0,0,0.2)");
  }

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  });
}

</script>
<script>
function renderStackedBar(prevalensi, integritas) {
  const ctx = document.getElementById("barChart").getContext("2d");
  if (window.barChart && typeof window.barChart.destroy === "function") window.barChart.destroy();
  window.barChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Faktor Koreksi"],
      datasets: [
        { label: "Prevalensi Korupsi", data: [prevalensi], backgroundColor: "#f87979" },
        { label: "Integritas Pelaksanaan SPI", data: [integritas], backgroundColor: "#36a2eb" }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: ctx => ctx.dataset.label + ": " + ctx.raw.toFixed(2)
          }
        },
        datalabels: {
          anchor: 'end',
          align: 'top',
          font: { size: 10 },
          formatter: v => v.toFixed(1)
        }
      },
      scales: {
        x: { stacked: true, display: false },
        y: { stacked: true, beginAtZero: true, max: 20, display: false }
      }
    },
    plugins: [ChartDataLabels]
  });
}

function renderHistoricalLineChart(filtered) {
  const komponen = ["Agregat", "Internal", "Eksternal", "Eksper"];
  const warna = ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728"];
  const datasets = komponen.map((k, i) => {
    const found = filtered.find(d => d["Index_name"] === k);
    return {
      label: k,
      data: [21,22,23,24].map(y => parseFloat(found["Value" + y]) || 0),
      borderColor: warna[i],
      backgroundColor: warna[i],
      tension: 0.3
    };
  });
  const ctx = document.getElementById("lineChartHistorical").getContext("2d");
  if (window.lineChartHistorical && typeof window.lineChartHistorical.destroy === "function") window.lineChartHistorical.destroy();
  window.lineChartHistorical = new Chart(ctx, {
    type: "line",
    data: {
      labels: ["2021", "2022", "2023", "2024"],
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: { mode: 'index', intersect: false },
        datalabels: {
          anchor: 'end',
          align: 'top',
          font: { size: 10 },
          formatter: v => v.toFixed(1)
        }
      },
      scales: {
        y: { min: 40, max: 100 }
      }
    },
    plugins: [ChartDataLabels]
  });
}

function renderFaktorKoreksiLineChart(filtered) {
  const found1 = filtered.find(d => d["Index_name"] === "Prevalensi Korupsi");
  const found2 = filtered.find(d => d["Index_name"] === "Integritas Pelaksanaan SPI");
  const dataset = [
    {
      label: "Prevalensi Korupsi",
      data: [21,22,23,24].map(y => parseFloat(found1["Value" + y]) || 0),
      borderColor: "#f87979",
      backgroundColor: "#f87979",
      tension: 0.3
    },
    {
      label: "Integritas Pelaksanaan SPI",
      data: [21,22,23,24].map(y => parseFloat(found2["Value" + y]) || 0),
      borderColor: "#36a2eb",
      backgroundColor: "#36a2eb",
      tension: 0.3
    }
  ];
  const ctx = document.getElementById("lineChartFaktorKoreksi").getContext("2d");
  if (window.lineChartFaktorKoreksi && typeof window.lineChartFaktorKoreksi.destroy === "function") window.lineChartFaktorKoreksi.destroy();
  window.lineChartFaktorKoreksi = new Chart(ctx, {
    type: "line",
    data: {
      labels: ["2021", "2022", "2023", "2024"],
      datasets: dataset
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: { mode: 'index', intersect: false },
        datalabels: {
          anchor: 'end',
          align: 'top',
          font: { size: 10 },
          formatter: v => v.toFixed(1)
        }
      },
      scales: {
        y: { beginAtZero: true, max: 20 }
      }
    },
    plugins: [ChartDataLabels]
  });
}

function renderRadarChart(data) {
  const ctx = document.getElementById("radarChart").getContext("2d");
  if (radarChart && typeof radarChart.destroy === "function") radarChart.destroy();

  const avg = data.reduce((a, b) => a + b, 0) / data.length;
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);

  if (avg >= 78) {
    gradient.addColorStop(0, "rgba(0,200,0,0.4)");
    gradient.addColorStop(1, "rgba(0,150,0,0.2)");
  } else if (avg >= 73) {
    gradient.addColorStop(0, "rgba(255,200,0,0.4)");
    gradient.addColorStop(1, "rgba(200,150,0,0.2)");
  } else {
    gradient.addColorStop(0, "rgba(200,0,0,0.4)");
    gradient.addColorStop(1, "rgba(150,0,0,0.2)");
  }

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: ["Internal", "Eksternal", "Eksper"],
      datasets: [{
        label: "Agregat",
        data: data,
        backgroundColor: gradient,
        borderColor: "#333",
        pointBackgroundColor: "#000"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ": " + ctx.raw.toFixed(2)
          }
        }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  });
}

</script>
</body>
</html>

